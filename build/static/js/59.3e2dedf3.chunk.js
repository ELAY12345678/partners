(this["webpackJsonppartners-apparta"]=this["webpackJsonppartners-apparta"]||[]).push([[59],{1094:function(e,t,a){"use strict";a.r(t);a(362);var r=a(363),d=(a(351),a(352)),i=(a(354),a(355)),o=(a(219),a(69)),s=(a(372),a(373)),n=a(0),c=a(42),l=a.n(c),m=a(144),p=a.n(m),u=a(385),h=a.n(u),y=a(27),b=a(359),v=a(356),j=a(360),w=a(14);const _=[{id:"credit_card",name:"Tarjeta de credito"},{id:"bank_transfer",name:"D\xe9bito autom\xe1tico"},{id:"manual_payment_invoice",name:"Factura"}],x="credit_card",g="bank_transfer",f="apparta_pay",O={credit_card:"Tarjeta de credito",bank_transfer:"D\xe9bito autom\xe1tico",apparta_pay:"AppartaPay",manual_payment_invoice:"Factura"},k=[{id:"completed",name:"Completado"},{id:"pending",name:"Pendiente"},{id:"rejected",name:"Rechazado"},{id:"crossed",name:"Cruzado"}],R=[{id:"app_reservations",name:"Reservas"},{id:"tmp_platform",name:"TMP"}],C={completed:"success",rejected:"error",pending:"processing"},E={completed:"Completado",pending:"Pendiente",rejected:"Rechazado",crossed:"Cruzado"},I="completed",P="pending",T="rejected",M="crossed",S=[{title:"Id",dataIndex:"id",key:"id",sorter:!0,width:80},{title:"Establecimiento",dataIndex:"establishment",key:"establishment",render:e=>null===e||void 0===e?void 0:e.name,width:200},{title:"Sucursal",dataIndex:"establishment_branch",key:"establishment_branch",width:200,render:e=>null===e||void 0===e?void 0:e.address},{title:"Metodo de pago",dataIndex:"method",key:"method",sorter:!0,render:e=>(null===O||void 0===O?void 0:O[e])||e,width:200},{title:"Estado",dataIndex:"status",key:"status",sorter:!0,width:130,render:e=>Object(w.jsx)(s.a,{color:(null===C||void 0===C?void 0:C[e])||"",children:(null===E||void 0===E?void 0:E[e])||e})},{title:"Monto total",dataIndex:"total_amount",key:"total_amount",sorter:!0,width:130,render:e=>"$ ".concat(h()(e||"").format("0,0"))},{title:"Tipo",dataIndex:"type",key:"type",sorter:!0,width:120,render:e=>"app_reservations"==e?"Reservas":"tmp_platform"==e?"TMP":"otras"},{title:"Fecha fin",dataIndex:"date_end",key:"date_end",sorter:!0,render:(e,t)=>((null===t||void 0===t?void 0:t.method)===x||(null===t||void 0===t?void 0:t.method)===g)&&e&&p()(e).format("YYYY-MM-DD h:mm a"),width:200},{title:"Wompi reference",dataIndex:"wompi_reference",key:"wompi_reference",sorter:!0,width:150},{title:"Ultimo intento de cobro",dataIndex:"last_payment_intent_date",key:"last_payment_intent_date",sorter:!0,render:e=>e&&p()(e).format("YYYY-MM-DD h:mm a"),width:200}];t.default=()=>{const e=Object(y.c)("invoice-payments"),[t,a]=Object(n.useState)(!1),[s,c]=Object(n.useState)([]),m=async t=>{let{id:a}=t;await e.find({query:{$client:{receiveByCreditCardInvoicePaymentId:a}}}).catch(e=>{o.b.error((null===e||void 0===e?void 0:e.message)||"Ha ocurrido un error!")})},u=async r=>{let{selectedRecords:d}=r;try{const r=l.a.map(d,"id").join(",");await(async t=>{let{id:a}=t;await e.find({query:{$client:{receiveByCreditCardInvoicePaymentId:a}}}).catch(e=>{o.b.error((null===e||void 0===e?void 0:e.message)||"Ha ocurrido un error!")})})({id:r}),o.b.info("Los pagos estan siendo procesados!"),await new Promise(e=>{setTimeout(()=>{e(),a(!t)},8e3)})}catch(i){o.b.error((null===i||void 0===i?void 0:i.message)||"Ha ocurrido un error!")}},g=async t=>{let{id:a,newStatus:r}=t;await e.patch(a,{status:r}).catch(e=>{o.b.error((null===e||void 0===e?void 0:e.message)||"Ha ocurrido un error!")})},O=async e=>{let{selectedRecords:r,newStatus:d}=e;try{const e=r||[];if(e.length){for(let t=0;t<e.length;t++){var i;await g({id:null===(i=e[t])||void 0===i?void 0:i.id,newStatus:d})}a(!t),o.b.success("Pagos completados exitosamente!")}}catch(s){o.b.error((null===s||void 0===s?void 0:s.message)||"Ha ocurrido un error!")}};return console.log("selectedRecordsselectedRecords",!l.a.every(s,e=>{var t;return e.establishment_branch_id===(null===(t=s[0])||void 0===t?void 0:t.establishment_branch_id)&&"pending"===(null===e||void 0===e?void 0:e.status)&&"credit_card"==(null===e||void 0===e?void 0:e.method)}),s),Object(w.jsx)(r.a.Content,{style:{height:"100%",overflow:"auto",padding:"2rem"},children:Object(w.jsx)(v.b,{selection:!0,onChangeSelection:(e,t)=>{c(t)},maxSelection:10,custom:!0,source:"invoice-payments",filterDefaultValues:{$sort:{id:-1},method:{$nin:[f]},date_end:{$gt:p()("2023-08-31","YYYY-MM-DD").endOf("day").format()}},searchField:"q",searchText:"Buscar",search:!0,permitFetch:!0,actions:{},updateSource:t,columns:S,extra:Object(w.jsxs)(d.a,{gutter:[8,8],children:[Object(w.jsx)(i.a,{children:Object(w.jsx)(b.a,{type:"primary",style:{borderRadius:"0.5rem"},onClick:async()=>{const e=Object(y.c)("invoice-payments");await e.find({query:{$client:{exportExcelPendingBankTransfer:!0}}}).then(e=>window.open(e.path,"_blank")).catch(e=>o.b.error(e.message||"No se pudo exportar los registros!"))},children:"Exportar pagos por d\xe9bito autom\xe1tico pendientes"})}),Object(w.jsx)(i.a,{children:Object(w.jsx)(j.b,{preview:!1,path:"invoicesPayments/import/",style:{borderRadius:"0.5rem",height:"32px !important"},title:"Importar pagos",allowTypes:["application/vnd.openxmlformats-officedocument.spreadsheetml.sheet"],onFinish:e=>(async e=>{const r=Object(y.c)("invoice-payments");await r.find({query:{$client:{importExcelCompletedBankTransferFilePath:"".concat(e)}}}).then(e=>{o.b.success(e.message),a(!t)}).catch(e=>o.b.error(e.message))})(e)})}),Object(w.jsx)(i.a,{children:Object(w.jsx)(b.a,{type:"primary",style:{borderRadius:"0.5rem"},disabled:l.a.isEmpty(s),onClick:async()=>await O({selectedRecords:s,newStatus:I}),children:"Completar pago"})}),Object(w.jsx)(i.a,{children:Object(w.jsx)(b.a,{type:"primary",danger:!0,style:{borderRadius:"0.5rem"},disabled:l.a.isEmpty(s),onClick:async()=>await O({selectedRecords:s,newStatus:T}),children:"Rechazar pago"})}),Object(w.jsx)(i.a,{children:Object(w.jsx)(b.a,{type:"primary",style:{borderRadius:"0.5rem"},disabled:l.a.some(s,e=>{let{method:t,status:a}=e;return t!==x||a!==P&&a!==T})||l.a.isEmpty(s),onClick:async()=>await(async e=>{let{selectedRecords:r}=e;try{const e=l.a.filter(r,e=>{let{method:t,status:a}=e;return t===x&&(a===P||a===T)});for(let t=0;t<e.length;t++){var d;await m({id:null===(d=e[t])||void 0===d?void 0:d.id})}o.b.info("Los pagos estan siendo procesados!"),await new Promise(e=>{setTimeout(()=>{e(),a(!t)},8e3)})}catch(i){o.b.error((null===i||void 0===i?void 0:i.message)||"Ha ocurrido un error!")}})({selectedRecords:s}),children:"Cobrar"})}),Object(w.jsx)(i.a,{children:Object(w.jsxs)(b.a,{type:"primary",style:{borderRadius:"0.5rem"},disabled:!!l.a.isEmpty(s)||!l.a.every(s,e=>{var t;return e.establishment_branch_id===(null===(t=s[0])||void 0===t?void 0:t.establishment_branch_id)&&"pending"===e.status&&"credit_card"==(null===e||void 0===e?void 0:e.method)}),onClick:async()=>await u({selectedRecords:s}),children:["Cobrar agrupados ",l.a.isEmpty(s)?"":l.a.every(s,e=>{var t;return e.establishment_branch_id===(null===(t=s[0])||void 0===t?void 0:t.establishment_branch_id)&&"pending"===e.status&&"credit_card"==(null===e||void 0===e?void 0:e.method)})?"$".concat(h()(l.a.sumBy(s,"total_amount_tax_incl")||"").format("0,0")):""]})}),Object(w.jsx)(i.a,{children:Object(w.jsx)(b.a,{type:"primary",style:{borderRadius:"0.5rem"},disabled:l.a.isEmpty(s),onClick:async()=>await O({selectedRecords:s,newStatus:M}),children:"Cruzar pagos"})})]}),filters:Object(w.jsxs)(w.Fragment,{children:[Object(w.jsx)(j.c,{alwaysOn:!0,source:"status",name:"status",label:"Estado",placeholder:"Estado",allowEmpty:!0,choices:k,size:"medium",style:{width:"15rem"}}),Object(w.jsx)(j.c,{alwaysOn:!0,source:"method",name:"method",label:"Metodo de pago",placeholder:"Metodo de pago",allowEmpty:!0,choices:_,size:"medium",style:{width:"15rem"}}),Object(w.jsx)(j.c,{alwaysOn:!0,source:"type",name:"type",label:"Tipo",placeholder:"Tipo",allowEmpty:!0,choices:R,size:"medium",style:{width:"15rem"}})]})})})}}}]);
//# sourceMappingURL=59.3e2dedf3.chunk.js.map