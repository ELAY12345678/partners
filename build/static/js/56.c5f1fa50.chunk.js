(this["webpackJsonppartners-apparta"]=this["webpackJsonppartners-apparta"]||[]).push([[56],{1096:function(e,i,t){"use strict";t.r(i);t(362);var a=t(363),l=(t(0),t(664)),n=t(14);i.default=()=>Object(n.jsx)(a.a.Content,{style:{height:"100%",overflow:"auto",padding:"2rem"},children:Object(n.jsx)(l.a,{})})},664:function(e,i,t){"use strict";t(366);var a=t(367),l=(t(394),t(393)),n=(t(354),t(355)),s=(t(436),t(438)),d=(t(371),t(374)),o=(t(357),t(358)),r=(t(220),t(361)),c=t(2),u=(t(219),t(69)),m=(t(386),t(387)),p=(t(351),t(352)),v=(t(143),t(142)),b=(t(372),t(373)),_=t(380),h=t(42),j=t.n(h),f=t(144),x=t.n(f),O=t(0),g=t(353),y=t(359),k=t(356),w=t(414),S=t(370),F=t(68),q=t(14);const V="h:mm a",C=[{id:"active",name:"Activo"},{id:"inactive",name:"Inactivo"}],I=[{day:"Lunes",id:0},{day:"Martes",id:1},{day:"Mi\xe9rcoles",id:2},{day:"Jueves",id:3},{day:"Viernes",id:4},{day:"S\xe1bado",id:5},{day:"Domingo",id:6},{day:"Festivos",id:7}],E=[{id:"all",name:"Una sola vez"},{id:"specific",name:"Recurrente"}],D=[{id:"all",name:"Mostrar en todos los establecimientos"},{id:"specific",name:"Mostrar en establecimientos espec\xedficos"}],H=[{id:"null",name:"Sin configurar"},{id:"5",name:"5 segundos"},{id:"30",name:"30 segundos"},{id:"60",name:"1 minuto"},{id:"300",name:"5 minutos"},{id:"900",name:"15 minutos"},{id:"1800",name:"30 minutos"},{id:"3600",name:"1 hora"},{id:"21600",name:"6 horas"}],N=e=>{let{onRemove:i,onEdit:t}=e;return[{title:"Nombre",dataIndex:"name",sorter:!0,width:200},{title:"Descripci\xf3n",dataIndex:"description",sorter:!0,width:200},{title:"Estado",dataIndex:"status",sorter:!0,width:100,render:e=>"active"===e?Object(q.jsx)(b.a,{color:"green",children:"Active"}):Object(q.jsx)(b.a,{color:"red",children:"Inactive"})},{title:"Establecimientos",dataIndex:"tables_partners",sorter:!0,width:"auto",render:(e,i)=>null!==i&&void 0!==i&&i.establishments_ids_included_information?j.a.map(JSON.parse(null===i||void 0===i?void 0:i.establishments_ids_included_information),(e,t)=>{let{full_name:a}=e;return Object(q.jsxs)("div",{children:[a,t+1===JSON.parse((null===i||void 0===i?void 0:i.establishments_ids_included_information)||[]).length?"":" , "]})}):""},{title:"Link",dataIndex:"link_url",sorter:!1},{title:"Acciones",dataIndex:"id",width:150,render:(e,a)=>Object(q.jsxs)(p.a,{children:[Object(q.jsx)(v.a,{type:"text",onClick:()=>t(a),icon:Object(q.jsx)(g.l,{})}),Object(q.jsx)(y.a,{type:"link",onClick:()=>i({id:e}),icon:Object(q.jsx)(g.h,{}),confirmText:"Desea eliminar?"})]})}]};i.a=e=>{let{location:i}=e;Object(F.b)("tables-partners-groups"),Object(F.b)("tables-partners");const t=Object(F.b)("establishments"),[b]=m.a.useForm(),f=m.a.useWatch("frequency",b),J=m.a.useWatch("targeting_scope",b),A=Object(F.b)("pop-ups"),[z,M]=Object(O.useState)(!1),[T,Y]=Object(O.useState)(),[B,L]=Object(O.useState)(!1),[P,W]=Object(O.useState)(),[$,R]=Object(O.useState)([]),[U,G]=Object(O.useState)([]),[K,Q]=Object(O.useState)(!1),[X,Z]=Object(O.useState)(1),ee=j.a.map(I,e=>{let{day:i,id:t}=e;return{value:Number(t||0)+1,label:i,checked:!1}}),[ie,te]=Object(O.useState)(ee),ae=Object(h.debounce)(async e=>{if(""===e)return R([]),void Z(1);await t.find({query:{q:e,$client:{skipJoins:!0},$limit:25,$select:["id","name"]}}).then(e=>{let{data:i}=e;const t=i.map(e=>{let{id:i,name:t}=e;return{establishment_id:i,full_name:t}});R(j.a.sortBy(t,[e=>{let{full_name:i}=e;return i}]))}).catch(e=>u.b.error(e))},500,{maxWait:800});Object(O.useEffect)(()=>{if(null!==T&&void 0!==T&&T.id){var e,i,t,a,l,n,s,d,o,r,u,m,p,v,_,h;if(null!==T&&void 0!==T&&null!==(e=T.pop_ups_schedules)&&void 0!==e&&null!==(i=e[0])&&void 0!==i&&i.day_of_week){const e=null===T||void 0===T?void 0:T.pop_ups_schedules.map(e=>{let{day_of_week:i}=e;return i}),i=ee.map(i=>Object(c.a)(Object(c.a)({},i),{},{checked:!!e.includes(null===i||void 0===i?void 0:i.value)}));te(i),b.setFieldsValue({days_of_week:i.length?i.filter(e=>!0===e.checked):null})}if("date"===(null===T||void 0===T||null===(t=T.pop_ups_schedules)||void 0===t||null===(a=t[0])||void 0===a?void 0:a.period_type))b.setFieldValue("day",x()(null===T||void 0===T||null===(_=T.pop_ups_schedules)||void 0===_||null===(h=_[0])||void 0===h?void 0:h.date));if(b.setFieldValue("frequency","date"===(null===T||void 0===T||null===(l=T.pop_ups_schedules)||void 0===l||null===(n=l[0])||void 0===n?void 0:n.period_type)?"all":"specific"),b.setFieldValue("targeting_scope",null===T||void 0===T?void 0:T.targeting_scope),b.setFieldValue("reappear_interval_minutes",null!==T&&void 0!==T&&null!==(s=T.pop_ups_schedules)&&void 0!==s&&null!==(d=s[0])&&void 0!==d&&d.reappear_interval_minutes?"".concat(null===T||void 0===T||null===(o=T.pop_ups_schedules)||void 0===o||null===(r=o[0])||void 0===r?void 0:r.reappear_interval_minutes):"null"),b.setFieldValue("start_time",x()(null===T||void 0===T||null===(u=T.pop_ups_schedules)||void 0===u||null===(m=u[0])||void 0===m?void 0:m.start_time,"HH:mm:ss")),b.setFieldValue("end_time",x()(null===T||void 0===T||null===(p=T.pop_ups_schedules)||void 0===p||null===(v=p[0])||void 0===v?void 0:v.end_time,"hh:mm a")),null!==T&&void 0!==T&&T.establishments_ids_included_information){var j;const e=JSON.parse(null===T||void 0===T?void 0:T.establishments_ids_included_information);G({data:e,total:null===(j=e||[])||void 0===j?void 0:j.length})}}else b.setFieldValue("frequency","all"),b.setFieldValue("targeting_scope","specific"),b.setFieldValue("name",""),b.setFieldValue("description",""),b.setFieldValue("link_url","")},[null===T||void 0===T?void 0:T.id]);return Object(q.jsxs)(q.Fragment,{children:[Object(q.jsx)(k.b,{custom:!0,source:"pop-ups",filterDefaultValues:{type:"system",$limit:1e3,$client:{showPopUpsSchedules:!0}},searchField:"q",searchText:"Pop-up...",search:!0,permitFetch:!0,actions:{},updateSource:B,columns:N({onRemove:async e=>{let{id:i}=e;await A.remove(i).then(()=>{u.b.success("Pop-up eliminada!"),L(!B)}).catch(e=>u.b.error("No se pudo eliminar el Sucursal! "+(null===e||void 0===e?void 0:e.message)))},onEdit:e=>{j.a.forEach(e,(i,t)=>{null===i&&delete e[t]}),Y(e),M(!0)}}),extra:Object(q.jsx)("div",{children:Object(q.jsx)(S.a,{icon:Object(q.jsx)(g.u,{}),type:"primary",onClick:()=>{M(!0),Y(),b.setFieldValue("frequency","all"),b.setFieldValue("targeting_scope","specific"),b.setFieldValue("reappear_interval_minutes","null"),te(ee)},children:"Agregar"})})}),z&&Object(q.jsx)(a.a,{title:"".concat(T?"Editar":"Crear"," Pop-up"),placement:"right",width:520,visible:z,onClose:()=>{b.resetFields(),Y(),Z(1),G([]),R([]),setTimeout(()=>{M(!1)},500)},children:Object(q.jsxs)(w.a,{textAcceptButton:"Guardar",initialValues:T,onSubmit:async(e,i,t)=>{if(e)return u.b.error(e);try{var a,l,n;if(x()(null===i||void 0===i?void 0:i.end_time).isBefore(x()(null===i||void 0===i?void 0:i.start_time)))return void u.b.error("\xa1Ups! El rango de horario no es v\xe1lido");const e=null===i||void 0===i?void 0:i.frequency,s="all"===e?void 0:j.a.map(ie.filter(e=>!0===(null===e||void 0===e?void 0:e.checked)),"value"),d=null===i||void 0===i||null===(a=i.start_time)||void 0===a?void 0:a.format("HH:mm:00"),o=null===i||void 0===i||null===(l=i.end_time)||void 0===l?void 0:l.format("HH:mm:00"),r="all"===e?x()(null===i||void 0===i?void 0:i.day).format("YYYY-MM-DD"):void 0,c={name:null===i||void 0===i?void 0:i.name,description:null===i||void 0===i?void 0:i.description,link_url:null===i||void 0===i?void 0:i.link_url,status:null===i||void 0===i?void 0:i.status,targeting_scope:null===i||void 0===i?void 0:i.targeting_scope,type:"system",establishments_ids_included:"all"===(null===i||void 0===i?void 0:i.targeting_scope)?null:JSON.stringify(null===U||void 0===U||null===(n=U.data)||void 0===n?void 0:n.map(e=>null===e||void 0===e?void 0:e.establishment_id)),establishments_ids_included_information:"all"===(null===i||void 0===i?void 0:i.targeting_scope)?null:JSON.stringify(null===U||void 0===U?void 0:U.data),meta_pop_ups_schedules:"all"===e?[{period_type:"date",date:r,start_time:d,end_time:o,reappear_interval_minutes:"null"!==(null===i||void 0===i?void 0:i.reappear_interval_minutes)?null===i||void 0===i?void 0:i.reappear_interval_minutes:void 0}]:j.a.map(s,e=>({period_type:"day_of_week",day_of_week:e,start_time:d,end_time:o,reappear_interval_minutes:"null"!==(null===i||void 0===i?void 0:i.reappear_interval_minutes)?null===i||void 0===i?void 0:i.reappear_interval_minutes:void 0}))};if(T&&null!==T&&void 0!==T&&T.id){await A.patch(null===T||void 0===T?void 0:T.id,c);t.resetFields()}else{await A.create(c);t.resetFields()}G([]),Y(),u.b.success("\xa1Pop-up creado exitosamente!."),setTimeout(()=>{L(!B),M(!1)},500)}catch(s){console.log("error",s)}},form:b,children:[Object(q.jsx)(r.a,{flex:1,name:"name",label:"Nombre",validations:[{required:!0,message:"Nombre es requerido"}]}),Object(q.jsx)(r.a,{flex:1,name:"description",label:"Descripci\xf3n",validations:[{required:!0,message:"Descripci\xf3n es requerida"}]}),Object(q.jsx)(r.a,{flex:1,name:"link_url",label:"Link",validations:[{required:!0,message:"Link es requerido"}]}),Object(q.jsx)(o.a,{flex:.5,name:"reappear_interval_minutes",label:"Intervalo",size:"large",validations:[{required:!0,message:"Intervalo es requerido"}],children:j.a.map(H,(e,i)=>{let{id:t,name:a}=e;return Object(q.jsx)(o.a.Option,{value:t,children:a},i)})}),Object(q.jsx)(o.a,{flex:.5,name:"status",label:"Estado",size:"large",children:j.a.map(C,(e,i)=>{let{id:t,name:a}=e;return Object(q.jsx)(o.a.Option,{value:t,children:a},i)})}),Object(q.jsx)(o.a,{flex:1,disabled:null===T||void 0===T?void 0:T.id,name:"frequency",label:"Frecuencia",size:"large",validations:[{required:!0,message:"Frecuencia es requerida"}],children:j.a.map(E,(e,i)=>{let{id:t,name:a}=e;return Object(q.jsx)(o.a.Option,{value:t,children:a},i)})}),"all"===f?Object(q.jsx)(d.a,{flex:1,xtype:"date",size:"large",label:"Fecha",name:"day",format:"MM/DD/YYYY",locale:_.a}):null,"specific"===f?Object(q.jsx)("div",{style:{},children:Object(q.jsx)(m.a.Item,{name:"day_of_week",rules:[{required:!1}],label:"D\xedas de la semana",labelCol:{style:{}},children:Object(q.jsx)("div",{style:{display:"flex",gap:"5px",marginTop:"2px",flexWrap:"wrap"},children:j.a.map(ie,e=>{let{value:i,label:t,checked:a}=e;return Object(q.jsx)(v.a,{type:a?"primary":"ghost",style:{minWidth:"100px",color:a?"white":"black"},onClick:async()=>{await(e=>{let{valueChecked:i}=e;const t=j.a.map(ie,e=>e.value===i?Object(c.a)(Object(c.a)({},e),{},{checked:!e.checked}):e);te(t);const a=t.filter(e=>!0===e.checked);b.setFieldsValue({day_of_week:a.length?a:null})})({valueChecked:i})},children:t})})})})}):null,Object(q.jsx)(s.a,{flex:.5,name:"start_time",label:"Hora inicio",use12Hours:!0,minuteStep:30,format:V,validations:[{required:!0,message:"Hora Inicio es requerida"}]}),Object(q.jsx)(s.a,{flex:.5,name:"end_time",label:"Hora fin",use12Hours:!0,minuteStep:30,format:V,validations:[{required:!0,message:"Hora Fin es requerida"}]}),Object(q.jsx)(o.a,{flex:1,name:"targeting_scope",label:"Alcance",size:"large",validations:[{required:!0,message:"Alcance es requerido"}],children:j.a.map(D,(e,i)=>{let{id:t,name:a}=e;return Object(q.jsx)(o.a.Option,{value:t,children:a},i)})}),"specific"===J?Object(q.jsxs)("div",{style:{width:"100%",gap:"4px"},children:[Object(q.jsxs)(p.a,{style:{width:"100%",gap:"4px",marginBottom:"8px"},children:[Object(q.jsx)(n.a,{flex:"auto",children:Object(q.jsx)(o.a,{showSearch:!0,label:"Establecimiento",placeholder:"A\xf1adir establecimiento",allowClear:!0,onSearch:ae,value:P,onClear:()=>W(),onSelect:e=>{W(e)},optionFilterProp:"children",style:{width:"100%"},filterOption:(e,i)=>i.children.toLowerCase().includes(e.toLowerCase()),children:j.a.map($,(e,i)=>{let{establishment_branch_id:t,establishment_id:a,full_name:l}=e;return Object(q.jsx)(o.a.Option,{value:JSON.stringify({establishment_branch_id:t,establishment_id:a}),children:l},i)})})}),Object(q.jsx)(n.a,{flex:"none",children:Object(q.jsx)(y.a,{type:"primary",onClick:()=>(async e=>{var i;let{establishmentBranchSelected:t,tables_partners_groups_id:a}=e;const l=$.filter(e=>{var i;return e.establishment_id===(null===(i=JSON.parse(t))||void 0===i?void 0:i.establishment_id)}),n=((null===U||void 0===U?void 0:U.data)||[]).concat(l);G({data:n,total:null===(i=n||[])||void 0===i?void 0:i.length}),u.b.success("Establecimiento a\xf1adido correctamente!"),W(),L(!B)})({establishmentBranchSelected:P,tables_partners_groups_id:null===T||void 0===T?void 0:T.id}),children:"A\xf1adir"})})]}),Object(q.jsx)(l.a,{style:{width:"100%"},loading:K,dataSource:(null===U||void 0===U?void 0:U.data)||[],columns:[{title:"Establecimiento",dataIndex:"full_name",key:"full_name",render:e=>e},{title:"Acciones",dataIndex:"establishment_id",key:"establishment_id",width:100,render:e=>Object(q.jsx)(y.a,{type:"link",onClick:()=>(e=>{let{id:i}=e;const t=U.data.filter(e=>e.establishment_id!==i);G({data:t,total:t.length}),u.b.success("Establecimiento eliminado correctamente!"),W(),L(!B)})({id:e}),icon:Object(q.jsx)(g.h,{}),confirmText:"Desea eliminar?"})}],pagination:{current:X,showSizeChanger:!1,pageSize:9,onChange:e=>{Z(e)},total:(null===U||void 0===U?void 0:U.total)||0,showTotal:e=>"Total ".concat(e," record").concat(e>1?"s":"")}})]}):null]})})]})}}}]);
//# sourceMappingURL=56.c5f1fa50.chunk.js.map