(this["webpackJsonppartners-apparta"]=this["webpackJsonppartners-apparta"]||[]).push([[45],{1130:function(e,t,a){"use strict";a.r(t);a(362);var n=a(363),i=(a(368),a(369)),s=(a(377),a(379)),r=(a(375),a(376)),c=(a(422),a(426)),l=(a(372),a(373)),o=a(6),d=a(42),b=a.n(d),u=a(356),m=a(364),h=a(144),j=a.n(h),p=a(385),x=a.n(p),f=(a(366),a(367)),y=(a(351),a(352)),_=(a(354),a(355)),O=(a(357),a(358)),g=(a(218),a(69)),v=a(0),w=a(353),I=a(359),S=a(360),k=a(370),C=a(2),E=(a(1070),a(1123)),F=(a(394),a(393)),T=a(12),U=a(1072),A=a.n(U),q=a(68),D=a(14);const $=["leftColumns","rightColumns"],R=["key"],P=e=>{let{leftColumns:t,rightColumns:a}=e,n=Object(T.a)(e,$);return Object(D.jsx)(E.a,Object(C.a)(Object(C.a)({},n),{},{children:e=>{let{direction:n,filteredItems:i,onItemSelectAll:s,onItemSelect:r,selectedKeys:c,disabled:l}=e;const o="left"===n?t:a,d={getCheckboxProps:e=>({disabled:l||e.disabled}),onSelectAll(e,t){console.log(e,t);const a=t.filter(e=>!e.disabled).map(e=>{let{key:t}=e;return t}),n=e?A()(a,c):A()(c,a);s(n,e)},onSelect(e,t){let{key:a}=e;Object(T.a)(e,R);r(a,t)},selectedRowKeys:c};return Object(D.jsx)(F.a,{rowSelection:d,columns:o,dataSource:i,size:"small",style:{pointerEvents:l?"none":void 0}})}}))},z=[{dataIndex:"full_name",title:"Establecimiento",render:(e,t)=>"".concat(e," - ").concat(null===t||void 0===t?void 0:t.city_name)}];var B=e=>{let{onChange:t,city_id:a,pay_benefit_id:n}=e;const i=Object(q.b)("establishments-branchs"),s=Object(q.b)("pay-benefits-establishments-branchs"),[r,c]=Object(v.useState)([]),[l,o]=Object(v.useState)([]),[u,m]=Object(v.useState)(""),[h,j]=Object(v.useState)([]),[p,x]=Object(v.useState)([]),f=Object(d.debounce)((e,t)=>{""!==e?i.find({query:{q:e,$client:t?{searchBranchsByCityId:t}:{fullName:!0}}}).then(e=>{c(b.a.sortBy(b.a.filter(e,e=>{let{establishment_branch_id:t}=e;return!b.a.find(p,e=>{let{establishment_branch_id:a}=e;return a===t})}),[e=>{let{full_name:t}=e;return t}]))}).catch(e=>g.b.error(e)):c([])},500,{maxWait:800});return Object(v.useEffect)(()=>{t(l)},[l,t]),Object(v.useEffect)(()=>{f(u,a)},[u,a]),Object(v.useEffect)(()=>{s.find({query:{pay_benefit_id:n,$limit:1e5}}).then(e=>{let{data:t}=e;x(t)}).catch(e=>g.b.error(e))},[n]),Object(D.jsx)(D.Fragment,{children:Object(D.jsx)(P,{showSelectAll:!1,showSearch:!0,dataSource:b.a.map([...r,...l],(e,t)=>Object(C.a)(Object(C.a)({},e),{},{key:"".concat(null===e||void 0===e?void 0:e.establishment_branch_id)})),targetKeys:h,onSearch:(e,t)=>"left"===e&&m(t),onChange:(e,t,a)=>{j(e),o([...b.a.filter(b.a.map(e,e=>b.a.find([...l,...r],t=>"".concat(t.establishment_branch_id)===e)))])},filterOption:(e,t)=>{var a,n;return null===t||void 0===t||null===(a=t.full_name)||void 0===a||null===(n=a.toLowerCase())||void 0===n?void 0:n.includes(null===e||void 0===e?void 0:e.toLowerCase())},leftColumns:z,rightColumns:z})})},V=a(383);const K=[{id:"active",name:"active",color:"success"},{id:"inactive",name:"inactive",color:"error"}],N=e=>{let{cities:t,onRemove:a}=e;return[{key:"establishment_id",dataIndex:"establishment_id",title:"Id Establecimiento",sorter:!0},{key:"establishment_branch_id",dataIndex:"establishment_branch_id",title:"Id Sucursal",sorter:!0},{key:"city_id",dataIndex:"city_id",title:"Ciudad",sorter:!0,render:e=>{var a;return(null===(a=b.a.find(t,t=>{let{id:a}=t;return e===a}))||void 0===a?void 0:a.name)||""}},{key:"status",dataIndex:"status",title:"Estado",sorter:!0,render:e=>{const t=b.a.find(K,t=>{let{id:a}=t;return a===e})||e;return Object(D.jsx)(l.a,{color:null===t||void 0===t?void 0:t.color,children:(null===t||void 0===t?void 0:t.name)||t})}},{title:"Acciones",dataIndex:"id",render:(e,t)=>Object(D.jsx)(D.Fragment,{children:Object(D.jsx)(I.a,{type:"link",onClick:()=>a({id:e}),icon:Object(D.jsx)(w.h,{}),confirmText:"Desea eliminar?"})})}]};var Y=e=>{let{pay_benefit_id:t,city_id:a}=e;const[n,s]=Object(v.useState)(!1),[r,c]=Object(v.useState)(!1),[l,o]=Object(v.useState)(),[d,m]=Object(v.useState)(a),h=Object(q.b)("pay-benefits-establishments-branchs"),[j,p]=Object(V.a)();return Object(D.jsxs)(D.Fragment,{children:[Object(D.jsx)(u.b,{custom:!0,updateSource:n,source:"pay-benefits-establishments-branchs",filterDefaultValues:{pay_benefit_id:t,$sort:{id:1}},actions:{},columns:N({cities:j,onRemove:async e=>{let{id:t}=e;await h.remove(t).then(()=>{g.b.success("Programaci\xf3n Eliminada!"),s(!n)}).catch(e=>g.b.error(e.message))}}),filters:Object(D.jsxs)(D.Fragment,{children:[Object(D.jsx)(i.a,{alwaysOn:!0,source:"establishment_id",name:"establishment_id",label:"Id Establecimiento",placeholder:"Id Establecimiento",allowEmpty:!0,style:{width:"200px"}}),Object(D.jsx)(i.a,{alwaysOn:!0,source:"establishment_branch_id",name:"establishment_branch_id",label:"Id Sucursal",placeholder:"Id Sucursal",allowEmpty:!0,style:{width:"200px"}}),Object(D.jsx)(S.c,{alwaysOn:!0,disabled:!!a,defaultValue:a,loading:p,source:"city_id",name:"city_id",label:"city_id",placeholder:"Ciudad",allowEmpty:!0,choices:j,size:"medium",style:{width:"15em"}})]}),extra:Object(D.jsx)("div",{children:Object(D.jsx)(k.a,{icon:Object(D.jsx)(w.u,{}),type:"primary",onClick:()=>c(!0),children:"Agregar"})})}),r&&Object(D.jsx)(f.a,{height:"80%",style:{height:"100%"},placement:"bottom",title:"A\xf1adir establecimientos participantes",visible:r,onClose:()=>{c(!1),m()},extra:Object(D.jsxs)(y.a,{gutter:8,children:[Object(D.jsx)(_.a,{children:Object(D.jsx)(O.a,{disabled:!!a,defaultValue:d,loading:p,placeholder:"Ciudad",allowClear:!0,onClear:()=>m(),choices:j,size:"medium",style:{width:"15em"},onSelect:e=>m(e),children:b.a.map(j,(e,t)=>{let{id:a,name:n}=e;return Object(D.jsx)(O.a.Option,{value:a,children:n},t)})})}),Object(D.jsx)(_.a,{children:Object(D.jsx)(I.a,{type:"primary",style:{borderRadius:"0.5rem"},onClick:()=>(async e=>{await h.create(b.a.map(e,e=>{let{establishment_branch_id:a,establishment_id:n,city_id:i}=e;return{establishment_branch_id:a,establishment_id:n,pay_benefit_id:t,city_id:i,status:"active"}})).then(e=>{o(),m(),s(!n),c(!1),g.b.success("Establecimientos agregados a este beneficio correctamente!")}).catch(e=>{g.b.error(e.message)})})(l),children:"Guardar"})})]}),children:Object(D.jsx)(B,{city_id:d,pay_benefit_id:t,onChange:e=>o(e)})})]})},L=(a(219),a(361)),M=(a(143),a(142)),J=(a(534),a(563)),G=a(54);const W=e=>{let{onRemove:t}=e;return[{key:"user_id",dataIndex:"user_id",title:"Id usuario",sorter:!0},{key:"pay_benefit_id",dataIndex:"pay_benefit_id",title:"Id beneficio",sorter:!0},{title:"Acciones",dataIndex:"id",render:(e,a)=>Object(D.jsx)(D.Fragment,{children:Object(D.jsx)(I.a,{type:"link",onClick:()=>t({id:e}),icon:Object(D.jsx)(w.h,{}),confirmText:"Desea eliminar?"})})}]};var H=e=>{let{pay_benefit_id:t}=e;const a=Object(q.b)("pay-benefits-users-segment"),[n,s]=Object(v.useState)(!1),[r,c]=Object(v.useState)(!1),[l,o]=Object(v.useState)(),[d,b]=Object(v.useState)();return Object(D.jsxs)(D.Fragment,{children:[Object(D.jsx)(u.b,{custom:!0,updateSource:n,source:"pay-benefits-users-segment",filterDefaultValues:{pay_benefit_id:t,$sort:{id:1}},actions:{},columns:W({onRemove:async e=>{let{id:t}=e;await a.remove(t).then(()=>{g.b.success("Usuario eliminado!"),s(!n)}).catch(e=>g.b.error(e.message))}}),extra:Object(D.jsx)("div",{children:Object(D.jsx)(k.a,{icon:Object(D.jsx)(w.u,{}),type:"primary",onClick:()=>c(!0),children:"Importar Usuarios"})}),filters:Object(D.jsx)(D.Fragment,{children:Object(D.jsx)(i.a,{alwaysOn:!0,source:"user_id",name:"user_id",label:"Id Usuario",placeholder:"Id Usuario",allowEmpty:!0,style:{width:"200px"}})})}),r&&Object(D.jsxs)(f.a,{placement:"right",title:"Importar usuarios",visible:r,onClose:()=>{c(!1),o(),b()},children:[Object(D.jsxs)(S.d,{textAcceptButton:"Importar",scrollToFirstError:!0,onSubmit:async(e,i,r)=>{if(e)return g.b.error(e);l&&t?await a.create({file_path:"".concat(l),pay_benefit_id:t},{query:{$client:{importExcel:"usersFromExcel"}}}).then(()=>{g.b.success("Usuarios cargados correctamente!"),c(!1),o(),b(),s(!n)}).catch(e=>g.b.error(e.message)):l?t||g.b.info("No se ha selecionado ning\xfan beneficio"):g.b.info("No se ha cargado ning\xfan archivo")},children:[d&&Object(D.jsx)(J.a,{flex:1,action:"https://www.mocky.io/v2/5cc8019d300000980a055e76",listType:"picture",defaultFileList:[d],onRemove:()=>{b(),o()}}),Object(D.jsx)(S.b,{flex:1,preview:!1,path:"/appartaPay/benefits/",style:{borderRadius:"0.5rem"},title:"Cargar archivo",allowTypes:["application/vnd.openxmlformats-officedocument.spreadsheetml.sheet"],onFinish:(e,t)=>{b(t),o(e)}}),Object(D.jsx)(M.a,{type:"link",onClick:()=>window.open("".concat(G.j).concat("payPayments/bonus/formato-bonos.xlsx"),"_blank"),children:"Descargar plantilla"})]}),Object(D.jsx)("hr",{}),Object(D.jsxs)(S.d,{textAcceptButton:"Agregar usuario",scrollToFirstError:!0,onSubmit:async(e,t,i)=>{if(e)return g.b.error(e);null!==t&&void 0!==t&&t.pay_benefit_id?await a.create(t).then(e=>{s(!n),c(!1),g.b.success("Usuario agregado a este beneficio correctamente!")}).catch(e=>{g.b.error(e.message)}):g.b.info("No se ha selecionado ning\xfan beneficio")},children:[Object(D.jsx)(L.a,{type:"hidden",name:"pay_benefit_id",initial:t}),Object(D.jsx)(i.a,{flex:1,label:"Id Usuario ",name:"user_id",size:"large",validations:[{required:!0,message:"Usuario ID es requerido"}]})]})]})]})};const Q=[{id:"claimed",name:"claimed",color:"success"},{id:"expired",name:"expired",color:"magenta"},{id:"canceled",name:"canceled",color:"error"},{id:"acquired",name:"acquired",color:"processing"}],X=[{key:"meta_user_id",dataIndex:"meta_user_id",title:"Usuario Id",sorter:!0},{key:"meta_establishment_id",dataIndex:"meta_establishment_id",title:"Id - Establecimiento",sorter:!0,render:(e,t)=>"".concat(e||""," - ").concat((null===t||void 0===t?void 0:t.meta_establishment)||"")},{key:"meta_establishment_branch_id",dataIndex:"meta_establishment_branch_id",title:"Id - Sucursal",sorter:!0,render:(e,t)=>"".concat(e||""," - ").concat((null===t||void 0===t?void 0:t.meta_establishment_branch_address)||"")},{key:"amount",dataIndex:"amount",title:"Monto",sorter:!0,render:e=>"$ ".concat(x()(e||"").format("0,0"))},{key:"expire_day",dataIndex:"expire_day",title:"D\xeda expiraci\xf3n",sorter:!0,render:e=>j()(e).format("YYYY-MM-DD h:mm:ss a")},{key:"status",dataIndex:"status",title:"Estado",sorter:!0,render:e=>{const t=b.a.find(Q,t=>{let{id:a}=t;return a===e})||e;return Object(D.jsx)(l.a,{color:null===t||void 0===t?void 0:t.color,children:(null===t||void 0===t?void 0:t.name)||t})}}];t.default=e=>{let{location:t}=e;const a=Object(o.q)(),{pay_benefit_id:l,benefit_name:d,isSpecific:b,city_id:h}=t.state;return Object(D.jsxs)(n.a.Content,{style:{height:"100%",overflow:"auto",padding:"2rem"},children:[Object(D.jsxs)(c.a,{children:[Object(D.jsx)(c.a.Item,{onClick:()=>a("/dashboard/management/pay-accounts",{state:{defaultSelectedTab:"4"}}),style:{cursor:"pointer"},children:"Beneficio"}),Object(D.jsx)(c.a.Item,{children:d})]}),Object(D.jsx)(r.a,{style:{background:"transparent",borderTop:0,marginTop:0}}),Object(D.jsxs)(m.b,{defaultActiveKey:"1",children:[b&&Object(D.jsx)(s.a.TabPane,{tab:"Sucursales",children:Object(D.jsx)(Y,{pay_benefit_id:l,city_id:h})},"2"),Object(D.jsx)(s.a.TabPane,{tab:"Usado por usuarios",children:Object(D.jsx)(u.b,{custom:!0,source:"pay-benefits-users",filterDefaultValues:{meta_pay_benefit_id:l,$sort:{id:1}},actions:{},columns:X,filters:Object(D.jsxs)(D.Fragment,{children:[Object(D.jsx)(i.a,{alwaysOn:!0,source:"meta_user_id",name:"meta_user_id",label:"Id Usuario",placeholder:"Id Usuario",allowEmpty:!0,style:{width:"200px"}}),Object(D.jsx)(i.a,{alwaysOn:!0,source:"meta_establishment_id",name:"meta_establishment_id",label:"Id Establecimiento",placeholder:"Id Establecimiento",allowEmpty:!0,style:{width:"200px"}}),Object(D.jsx)(i.a,{alwaysOn:!0,source:"meta_establishment_branch_id",name:"meta_establishment_branch_id",label:"Id Sucursal",placeholder:"Id Sucursal",allowEmpty:!0,style:{width:"200px"}})]})})},"4"),Object(D.jsx)(s.a.TabPane,{tab:"Segmento de usuarios",children:Object(D.jsx)(H,{pay_benefit_id:l})},"6")]})]})}},364:function(e,t,a){"use strict";a.d(t,"a",function(){return u}),a.d(t,"b",function(){return m});a(377);var n,i,s,r,c,l=a(379),o=(a(351),a(352)),d=a(61),b=a(53);b.default.div(n||(n=Object(d.a)(["\n  display: flex;\n  justify-content: start;\n  align-items: baseline;\n  flex-wrap: wrap;\n\n  width:100%!important;\n\n  background-color:var(--gray-dark-1)!important;\n  color:#fff!important;\n\n  & .ant-checkbox-wrapper{\n    margin:0px 10px;\n  }\n  & h2{\n    color: #fff!important;\n    text-transform: uppercase!important;\n    padding: 4px 10px!important;\n    font-size: 16px!important;\n    vertical-align: middle!important;\n    margin-bottom: 0px!important;\n  }\n"]))),b.default.div(i||(i=Object(d.a)(["\n\n    position:relative;\n   \n    display: flex;\n    justify-content: start;\n    align-items: center;\n\n    & .container{\n      width: 34px;\n      position:relative;\n    }\n    & .container:hover .ant-btn{\n      display:inline-block;\n    }\n    & .ant-btn,.ant-btn:hover{\n      position: absolute;\n      left: 0;\n      top: 0;\n      z-index: 999;\n      height: 34px!important;\n      display: none;\n      width: 34px!important;\n      background: #0010214f!important;\n      color: #FFF!important;\n      font-weight: bold;\n      display:none;\n    }\n"]))),b.default.div(s||(s=Object(d.a)(["\n    display:flex;\n    justify-content: space-between;\n"])));const u=Object(b.default)(o.a)(r||(r=Object(d.a)(["\n  box-shadow: rgba(0, 0, 0, 0.1) 0px 4px 12px;\n  border-radius:1rem;\n  background: #fff ;\n  padding: 2rem;\n"]))),m=Object(b.default)(l.a)(c||(c=Object(d.a)(["\n    & .ant-tabs-nav{\n        background-color:white;\n        border-radius:1rem;\n        box-shadow: rgb(0 0 0 / 10%) 0px 4px 12px;\n        padding:0 1rem;\n    }\n"])))},383:function(e,t,a){"use strict";a.d(t,"a",function(){return r});a(218);var n=a(69),i=a(0),s=a(68);const r=()=>{const e=Object(s.b)("cities"),[t,a]=Object(i.useState)([]),[r,c]=Object(i.useState)(!1);return Object(i.useEffect)(()=>{c(!0),e.find({query:{$limit:1e5,$sort:{name:1}}}).then(e=>{let{data:t}=e;a(t),c(!1)}).catch(e=>{n.b.error(e.message),a([]),c(!1)})},[]),[t,r]}}}]);
//# sourceMappingURL=45.b5f9273f.chunk.js.map