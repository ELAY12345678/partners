(this["webpackJsonppartners-apparta"]=this["webpackJsonppartners-apparta"]||[]).push([[68],{1133:function(e,t,a){"use strict";a.r(t);a(362);var s=a(363),r=a(0),i=(a(366),a(367)),n=(a(394),a(393)),l=(a(354),a(355)),c=(a(357),a(358)),o=(a(219),a(361)),d=a(2),b=(a(218),a(69)),u=(a(351),a(352)),h=(a(143),a(142)),j=(a(372),a(373)),m=a(42),p=a.n(m),v=a(353),O=a(359),_=a(356),x=a(414),g=a(370),f=a(68);var S=a(14);const w=[{id:"active",name:"Active"},{id:"inactive",name:"Inactive"}],y=e=>{let{onRemove:t,onEdit:a}=e;return[{title:"Id",dataIndex:"id",sorter:!0,width:100},{title:"Nombre",dataIndex:"name",sorter:!0,width:200},{title:"Estado",dataIndex:"status",sorter:!0,width:100,render:e=>"active"===e?Object(S.jsx)(j.a,{color:"green",children:"Active"}):Object(S.jsx)(j.a,{color:"red",children:"Inactive"})},{title:"Establecimientos",dataIndex:"tables_partners",sorter:!0,width:"auto",render:(e,t)=>p.a.map(null===t||void 0===t?void 0:t.tables_partners,(e,a)=>{let{establishment_branch_address:s,establishment_name:r}=e;return Object(S.jsxs)("div",{children:[r+" - "+s,a+1===(null===t||void 0===t?void 0:t.tables_partners.length)?"":" , "]})})},{title:"Acciones",dataIndex:"id",width:150,render:(e,s)=>Object(S.jsxs)(u.a,{children:[Object(S.jsx)(h.a,{type:"text",onClick:()=>a(s),icon:Object(S.jsx)(v.l,{})}),Object(S.jsx)(O.a,{type:"link",onClick:()=>t({id:e}),icon:Object(S.jsx)(v.h,{}),confirmText:"Desea eliminar?"})]})}]};var C=e=>{let{establishment_id:t}=e;const a=Object(f.b)("tables-partners-groups"),s=Object(f.b)("tables-partners"),h=Object(f.b)("establishments-branchs"),[j,C]=Object(r.useState)(!1),[k,E]=Object(r.useState)(),[I,A]=Object(r.useState)(!1),[N,T]=Object(r.useState)(),[B,q]=Object(r.useState)([]),[G,$]=Object(r.useState)(1),z=Object(m.debounce)(e=>{if(""===e)return q([]),void $(1);h.find({query:{q:e,$client:{fullName:!0}}}).then(e=>{q(p.a.sortBy(e,[e=>{let{full_name:t}=e;return t}]))}).catch(e=>b.b.error(e))},500,{maxWait:800}),[F,J,D]=(e=>{let{tables_partners_groups_id:t,page:a,source:s,filters:i}=e;const n=Object(f.b)(s),[l,c]=Object(r.useState)({}),[o,u]=Object(r.useState)(!1),h=()=>{u(!0);try{if(null==(null===i||void 0===i?void 0:i.tables_partners_groups_id))return c([]),void u(!1);n.find({query:Object(d.a)(Object(d.a)({},i),{},{$limit:9,$skip:9*(a-1)})}).then(e=>{var t;let{data:a,total:s}=e;const r=a.map(e=>Object(d.a)(Object(d.a)({},e),{},{partners:e.partners.map(e=>{const t=a.find(t=>t.establishment_id===e.tables_partners_establishment_id&&t.establishment_branch_id===e.tables_partners_establishment_branch_id);return Object(d.a)(Object(d.a)({},e),{},{id:t?t.id:null})})}));c({data:(null===r||void 0===r||null===(t=r[0])||void 0===t?void 0:t.partners)||[],total:s}),u(!1)}).catch(()=>{c([]),u(!1)})}catch(e){b.b.error(e.message),c([]),u(!1)}};return Object(r.useEffect)(()=>{t&&h()},[t,a]),[l,h,o]})({source:"tables-partners",tables_partners_groups_id:(null===k||void 0===k?void 0:k.id)||null,page:G,filters:{tables_partners_groups_id:null===k||void 0===k?void 0:k.id}});return Object(S.jsxs)(S.Fragment,{children:[Object(S.jsx)(_.b,{custom:!0,source:"tables-partners-groups",filterDefaultValues:{$client:{showTablesPartners:!0},$select:["id","name","status"]},searchField:"name",searchText:"Grupo...",search:!0,permitFetch:!0,actions:{},updateSource:I,columns:y({onRemove:async e=>{let{id:t}=e;await a.remove(t).then(()=>{b.b.success("Sucursal eliminada!"),A(!I),J()}).catch(e=>b.b.error("No se pudo eliminar el Sucursal! "+(null===e||void 0===e?void 0:e.message)))},onEdit:e=>{p.a.forEach(e,(t,a)=>{null===t&&delete e[a]}),E(e),C(!0)}}),extra:Object(S.jsx)("div",{children:Object(S.jsx)(g.a,{icon:Object(S.jsx)(v.u,{}),type:"primary",onClick:()=>{C(!0),E(),J()},children:"Agregar"})})}),j&&Object(S.jsx)(i.a,{title:"".concat(k?"Editar":"Crear"," Grupo"),placement:"right",width:520,visible:j,onClose:()=>{E(),$(1),q([]),setTimeout(()=>{C(!1)},500)},children:Object(S.jsxs)(x.a,{textAcceptButton:"Guardar",initialValues:k,onSubmit:async(e,t,s)=>{if(e)return b.b.error(e);if(k&&k.id){const e=Object(d.a)(Object(d.a)({},t),{},{pay_account:void 0});await a.patch(k.id,e).then(()=>{b.b.success("Grupo actualizado!"),C(!1),E(),A(!I)}).catch(e=>b.b.error(e.message))}else try{const e={name:null===t||void 0===t?void 0:t.name,status:null===t||void 0===t?void 0:t.status};await a.create(e).then(async e=>{console.log("reponse tablespartners group",null===e||void 0===e?void 0:e.id),b.b.success("Grupo Creado!"),A(!I),C(!1)}).catch(e=>b.b.error(e.message))}catch(r){console.log("datadatadata e",r)}},children:[Object(S.jsx)(o.a,{flex:1,name:"name",label:"Nombre",validations:[{required:!0,message:"Nombre es requerido"}]}),Object(S.jsx)(c.a,{flex:1,name:"status",label:"Estado",size:"large",children:p.a.map(w,(e,t)=>{let{id:a,name:s}=e;return Object(S.jsx)(c.a.Option,{value:a,children:s},t)})}),Object(S.jsxs)(u.a,{style:{width:"100%",gap:"4px"},children:[Object(S.jsx)(l.a,{flex:"auto",children:Object(S.jsx)(c.a,{showSearch:!0,label:"Sucursal",placeholder:"A\xf1adir sucursal",allowClear:!0,disabled:!(null!==k&&void 0!==k&&k.id),onSearch:z,value:N,onClear:()=>T(),onSelect:e=>{T(e)},optionFilterProp:"children",style:{width:"100%"},filterOption:(e,t)=>t.children.toLowerCase().includes(e.toLowerCase()),children:p.a.map(B,(e,t)=>{let{establishment_branch_id:a,establishment_id:s,full_name:r}=e;return Object(S.jsx)(c.a.Option,{value:JSON.stringify({establishment_branch_id:a,establishment_id:s}),children:r},t)})})}),Object(S.jsx)(l.a,{flex:"none",children:Object(S.jsx)(O.a,{type:"primary",disabled:!(null!==k&&void 0!==k&&k.id),onClick:()=>(async e=>{let{establishmentBranchSelected:t,tables_partners_groups_id:a}=e;console.log("establishmentBranchSelectedestablishmentBranchSelected",t);const r=Object(d.a)(Object(d.a)({},JSON.parse(t)),{},{tables_partners_groups_id:a});await s.create(r).then(()=>{b.b.success("Establecimiento a\xf1adido correctamente!"),T(),A(!I),J()}).catch(e=>{b.b.error(null===e||void 0===e?void 0:e.message)})})({establishmentBranchSelected:N,tables_partners_groups_id:null===k||void 0===k?void 0:k.id}),children:"A\xf1adir"})})]}),Object(S.jsx)(n.a,{style:{width:"100%"},loading:D,dataSource:(null===F||void 0===F?void 0:F.data)||[],columns:[{title:"Establecimiento",dataIndex:"establishment_name",key:"establishment_name",render:(e,t)=>{let{establishments_branchs_address:a}=t;return e+" - "+a}},{title:"Acciones",dataIndex:"id",key:"id",width:100,render:e=>Object(S.jsx)(O.a,{type:"link",onClick:()=>(e=>{let{id:t}=e;s.remove(t).then(()=>{b.b.success("Establecimiento eliminado correctamente!"),T(),A(!I),J()}).catch(e=>{b.b.error(null===e||void 0===e?void 0:e.message)})})({id:e}),icon:Object(S.jsx)(v.h,{}),confirmText:"Desea eliminar?"})}],pagination:{current:G,showSizeChanger:!1,pageSize:9,onChange:e=>{$(e)},total:(null===F||void 0===F?void 0:F.total)||0,showTotal:e=>"Total ".concat(e," record").concat(e>1?"s":"")}})]})})]})};t.default=()=>Object(S.jsx)(s.a.Content,{style:{height:"100%",overflow:"auto",padding:"2rem"},children:Object(S.jsx)(C,{})})}}]);
//# sourceMappingURL=68.f91ceca0.chunk.js.map