(this["webpackJsonppartners-apparta"]=this["webpackJsonppartners-apparta"]||[]).push([[52],{1129:function(e,t,n){"use strict";n.r(t);n(362);var a,i=n(363),r=(n(351),n(352)),l=(n(354),n(355)),c=(n(357),n(358)),o=(n(220),n(361)),s=n(2),d=(n(429),n(430)),p=(n(403),n(428)),u=(n(143),n(142)),b=(n(219),n(69)),g=(n(399),n(397)),j=n(12),m=n(0),h=n(42),f=n.n(h),O=n(455),x=n(591),y=n(61),v=n(53);const S=v.default.div(a||(a=Object(y.a)(["\n  & .head-tools {\n    background: var(--white) !important;\n    margin: 0px 8px !important;\n  }\n  & .item {\n    padding-left: 4px;\n    border-left: 3px solid transparent !important;\n  }\n  & .item.selected {\n    border-left: 3px solid var(--color-primary) !important;\n  }\n  & .item-container {\n  }\n  & .item-color,\n  .item-container {\n    display: flex;\n    justify-content: start;\n    align-items: center;\n  }\n  & .item-container > * {\n    margin: 0px 4px;\n  }\n  & .item-price {\n  }\n  & .color {\n    width: 20px;\n    height: 20px;\n    border-radius: 50%;\n    padding: 4px;\n    margin: 0px 4px;\n  }\n  & .name {\n    text-transform: capitalize;\n    font-size: 16px;\n    font-weight: bold;\n  }\n"])));var w,C,k,E=n(1060);v.default.div(w||(w=Object(y.a)(["\n  padding: 0px !important;\n  & .sections-name-properties {\n    font-size: 12px;\n  }\n  & .ant-card-meta-title {\n    font-size: 11px;\n  }\n  & .container-neighborhood > span {\n    font-size: 12px;\n  }\n  & .price {\n    font-size: 11px;\n  }\n  & .ant-avatar-lg {\n    width: 17px !important;\n    height: 17px !important;\n  }\n  & .sections-description {\n    min-width: 88px;\n  }\n  & .description {\n    font-size: 13px;\n  }\n  & .sections-description-rooms {\n    min-width: 86px;\n    margin-left: 6px;\n  }\n  & .section-color-tag span {\n    font-size: 8px;\n    text-transform: uppercase;\n    font-weight: bold;\n  }\n  & .ant-card {\n    width: 210px;\n    margin: 0px !important;\n  }\n  & .ant-card-cover {\n    height: 137px !important;\n  }\n  & .ant-card-body {\n    padding: 6px 12px 9px 12px !important;\n    overflow: hidden;\n  }\n  & .ant-card .cover img {\n    height: 138px;\n  }\n  & .tools {\n    top: 94px !important;\n  }\n"])));const N=v.default.div(C||(C=Object(y.a)(["\n   padding:0px!important;\n     height:","!important;\n    height:","\n    & .app-map{\n        height:100% ;\n    }\n    \n"])),e=>{let{height:t}=e;return t||"100px"},e=>{let{size:t}=e;switch(t){case"large":return"100vh!important;";case"medium":return"600px!important;";case"small":return"400px!important;";case"tiny":return"200px!important;";default:return"100%!important;"}});v.default.div(k||(k=Object(y.a)(["\n  background-color: #e74c3c;\n  border-radius: 50%;\n  width: 20px;\n  height: 20px;\n  cursor: pointer;\n  border: 4px solid #eaa29b;\n"])));var z=n(68),q=n(14);const D=["onMapChange","onSelect","source","reference","refresh"];let _=0;var A=e=>{let{onMapChange:t,onSelect:n,source:a="polygon",reference:i,refresh:r}=e,l=Object(j.a)(e,D);const[c,o]=Object(m.useState)(),[d,p]=Object(m.useState)(),[u,g]=Object(m.useState)([]),[h,O]=Object(m.useState)([]),[x,y]=Object(m.useState)(!1),[v,S]=Object(m.useState)(!0),[w,C]=Object(m.useState)(),[k,A]=Object(m.useState)(),[F,P]=Object(m.useState)(),[I,M]=Object(m.useState)({lat:52.52047739093263,lng:13.36653284549709}),[R,V]=Object(m.useState)(!1),T=async(e,n)=>{t&&n&&await t(e,n)},$=f.a.debounce(T,800,{maxWait:1e3}),[L,B]=Object(m.useState)(),J=Object(m.useRef)(null),W=Object(m.useRef)([]),H=(f.a.debounce(T,800,{maxWait:800}),Object(m.useCallback)((e,t)=>{let n=W.current.find(e=>e.id==t.id);if(n&&n.polygon){let{polygon:e}=n;const t=e.getPath().getArray().map(e=>({lat:e.lat(),lng:e.lng()}));B(t)}C(t),$(e,t)},[B]),Object(m.useCallback)(()=>{J.current=null},[]));Object(m.useEffect)(()=>{f.a.isEqual(l.polygon,k)||B(l.polygon)},[l.polygon]),Object(m.useEffect)(()=>{f.a.isEqual(l.record,d)||p(l.record)},[l.record]),Object(m.useEffect)(()=>{f.a.isEqual(l.filterDefaultValues,F)||P(l.filterDefaultValues)},[l.filterDefaultValues]),Object(m.useEffect)(()=>{F&&i&&(S(!0),Object(z.b)(i).find({query:Object(s.a)(Object(s.a)({},F),{},{$limit:50})}).then(e=>{let{data:t}=e;S(!1),O(t.map(e=>Object(s.a)({path:JSON.parse(e.polygon)},e)))}).catch(e=>{S(!1),b.b.error(e.message)}))},[F,r]),Object(m.useEffect)(()=>{},[k]),Object(m.useEffect)(()=>{if(l.polygon&&l.polygon.lat&&l.polygon.lng){let e=l.polygon;M({lat:e.lat,lng:e.lng})}},[l.polygon]);const U=e=>{var t=new window.google.maps.LatLngBounds;return e.getPath().forEach((e,n)=>{t.extend(e)}),t};return Object(m.useEffect)(()=>{if(l.selected&&!f.a.isEqual(l.selected,w)){C(l.selected);let e=W.current.find(e=>l.selected.id==e.id);if(e){let{polygon:t}=e;if(t){let e=U(t).getCenter();M({lat:e.lat(),lng:e.lng()})}}}},[l.selected]),Object(q.jsx)(N,{height:l.height,className:"App",children:Object(q.jsx)(E.c,{id:"script-loader",googleMapsApiKey:"AIzaSyBbsQSRn1eit85DvTMfTFR07HYMbjVkzqA",language:"en",region:"us",children:Object(q.jsxs)(E.a,{loading:v,mapContainerClassName:"app-map",center:I,zoom:11,version:"weekly",on:!0,children:[c&&Object(q.jsx)(E.b,{position:null===c||void 0===c?void 0:c.positionInfo,open:!0,onCloseClick:e=>{o()},children:Object(q.jsx)("div",{style:{backgroundColor:"white",padding:15},children:Object(q.jsxs)("div",{style:{fontSize:15,fontColor:"#08233B"},children:[c.name,Object(q.jsx)("br",{}),window.google.maps.geometry.spherical.computeArea(c.polygon.getPath())/1e6," km",Object(q.jsx)("sup",{children:"2"})]})})}),h&&h.map(e=>Object(q.jsx)(E.d,{editable:w&&e.id==w.id,options:{strokeColor:e.color||"#FF0000",fillColor:e.color||"#FF0000",strokeOpacity:.8,strokeWeight:2,fillOpacity:.3},draggable:!0,path:e.path,onMouseDown:()=>{let e=setTimeout(()=>{_++,_>5&&(V(!0),clearTimeout(e))},100)},onMouseUp:t=>{if(w){let t=W.current.find(t=>t.id==e.id);if(t){let n=t.polygon;if(n){const a=n.getPath().getArray().map(e=>({lat:e.lat(),lng:e.lng()}));w.id!=e.id&&C(e),$(a,t)}}}else w||C(e)},onDragEnd:t=>{if(V(!1),w){let t=W.current.find(t=>t.id==e.id);if(t){let n=t.polygon;if(n){const a=n.getPath().getArray().map(e=>({lat:e.lat(),lng:e.lng()}));w.id!=e.id&&C(e),$(a,t)}}}else w||C(e)},onClick:t=>{if(w){let t=W.current.find(t=>t.id===e.id),n=U(t.polygon).getCenter();o(Object(s.a)(Object(s.a)({},t),{},{positionInfo:{lat:n.lat(),lng:n.lng()}}))}},onLoad:t=>((e,t)=>{t&&("undefined"==typeof W.current.find(e=>t.id==e.id)&&(t.polygon=e,W.current.push(t)),y(W.current.length>=h.length))})(t,e),onUnmount:H}))]})})})},F=n(360),P=n(577),I=n(353),M=n(383);const R=["onChange","actions"],V=["onSelect","filterDefaultValues","refresh","onSubmit","onItemSelect","cities_id","cities","reference","buttonText","title"],T=["record"],$=e=>{let{onChange:t,actions:n={edit:!0,delete:!0}}=e,a=Object(j.a)(e,R);return Object(q.jsx)(g.a,{className:a.className||"list-menu",onClick:e=>{let{key:n}=e;t&&t(n,a.record)},items:[n.edit&&{key:"edit",label:"Editar",icon:Object(q.jsx)(I.l,{})},n.delete&&{key:"delete",label:"Eliminar",icon:Object(q.jsx)(I.h,{})}]})},L=e=>{let{onSelect:t,filterDefaultValues:n,refresh:a,onSubmit:i,onItemSelect:r,cities_id:l,cities:g,reference:h,buttonText:f,title:y}=e,v=Object(j.a)(e,V);const[w,C]=Object(m.useState)([]),[k,E]=Object(m.useState)(!1),[N,D]=Object(m.useState)(!1),[_,A]=Object(m.useState)([{lat:52.52549080781086,lng:13.398118538856465},{lat:52.48578559055679,lng:13.36653284549709},{lat:52.48871246221608,lng:13.44618372440334}]),[M,R]=Object(m.useState)(),T=(e,t)=>{switch(e){case"edit":R(t),E(!0);break;case"delete":t.id&&(n=t.id,Object(z.b)("report-zones").remove(n).then(e=>{b.b.success("Pol\xedgono eliminado!"),i&&i(),L()}).catch(e=>{b.b.error(e.message)}))}var n},L=()=>{if(h){const e=Object(z.b)(h);D(!0),e.find({query:Object(s.a)(Object(s.a)({},n),{},{$limit:50,$sort:{id:-1}})}).then(e=>{let{data:t}=e;C(t),D(!1)}).catch(e=>{D(!1),b.b.error(e.message)})}};return Object(m.useEffect)(()=>{L()},[v.restaurant_id,a]),Object(m.useEffect)(()=>{v.selected&&R(v.selected)},[v.selected]),Object(m.useEffect)(()=>{t(M)},[M]),Object(m.useEffect)(()=>{if((null===M||void 0===M||!M.id)&&v.center&&v.center.lat&&v.center.lng){let i=[],{google:r}=window;if(r&&r.maps&&r.maps.geometry&&r.maps.geometry.spherical){var e=new r.maps.LatLng(v.center.lat,v.center.lng),t=r.maps.geometry.spherical.computeOffset(e,1e3,0),n=r.maps.geometry.spherical.computeHeading(e,t)+90,a=r.maps.geometry.spherical.computeOffset(e,1e3,n);i.push({lat:e.lat(),lng:e.lng()}),i.push({lat:t.lat(),lng:t.lng()}),i.push({lat:a.lat(),lng:a.lng()}),A(i)}}},[v.center]),Object(q.jsxs)(S,{children:[Object(q.jsx)(d.b,{header:Object(q.jsxs)("div",{className:"head",children:[Object(q.jsx)("h3",{children:y}),Object(q.jsx)("div",{className:"head-tools",children:Object(q.jsx)(u.a,{onClick:()=>{R(null),E(!0)},type:"primary",block:!0,icon:Object(q.jsx)(I.u,{}),children:f||"Agregar Zona de Cobertura"})})]}),renderItem:(e,t)=>{let n=e;return Object(q.jsx)(d.b.Item,{actions:[Object(q.jsx)("div",{children:Object(q.jsx)(p.a,{trigger:["click"],overlay:()=>Object(q.jsx)($,{onChange:e=>T(e,n),record:n}),children:Object(q.jsx)(u.a,{type:"link",icon:Object(q.jsx)(I.r,{})})})})],className:"item ".concat(M&&M.id==n.id?"selected":""),onClick:()=>{n&&(e=>{r&&r(e),R(e)})(n)},children:Object(q.jsxs)("div",{className:"item-container",children:[Object(q.jsx)("div",{className:"item-color",children:Object(q.jsx)("div",{style:{background:n.color||"#cccccc4a"},className:"color"})}),Object(q.jsxs)("div",{className:"item-name",children:[Object(q.jsx)("div",{className:"name",children:e.name}),e.price&&Object(q.jsx)("div",{className:"item-price",children:Object(P.a)(e.price)})]})]})},t)},dataSource:w}),Object(q.jsx)(O.a,{title:M&&null!==M&&void 0!==M&&M.id?"Editar Pol\xedgono":"Crear Pol\xedgono",width:700,onCancel:()=>{E(!1),R(null)},visible:k,children:Object(q.jsxs)(F.d,{id:M&&M.id,source:"report-zones",onSubmit:(e,t)=>{if(e)return b.b.error(e.message);E(!1),R(null),r&&r(t),R(t),i&&i(t),L()},query:{$select:["id","name","color","city_id","danger_level"]},allowNull:!0,children:[Object(q.jsx)(o.a,{name:"name",flex:1,label:"Nombre",placeholder:"Nombre",validations:[{required:!0,message:"Este campo es requerido"}]}),Object(q.jsxs)(c.a,{flex:1,name:"danger_level",label:"Danger level",placeholder:"Danger level null - No hay riesgo",allowClear:!0,children:[Object(q.jsx)(c.a.Option,{value:1,children:"1 - No hay riesgo"},1),Object(q.jsx)(c.a.Option,{value:2,children:"2 - Riesgo minimo"},2),Object(q.jsx)(c.a.Option,{value:3,children:"3 - Riesgo maximo"},3)]}),Object(q.jsx)(o.a,{type:"hidden",name:"city_id",initial:Number(v.restaurant_id)}),Object(q.jsx)(x.a,{flex:1,name:"color",label:"Color",placeholder:"Color",validations:[{required:!0,message:"Este campo es requerido"}]}),!(null!==M&&void 0!==M&&M.id)&&Object(q.jsx)(o.a,{type:"hidden",name:"polygon",initial:_})]})})]})};t.default=e=>{let{record:t}=e;Object(j.a)(e,T);const[n,a]=Object(m.useState)(),[o,s]=Object(m.useState)(),[d,p]=Object(m.useState)(),[u,g]=Object(m.useState)(),[h,O]=Object(m.useState)(!1),[x,y]=Object(m.useState)(!0),[v,S]=Object(M.a)();return Object(m.useEffect)(()=>{setTimeout(()=>{y(!0)},100)},[x]),Object(m.useEffect)(()=>{n&&s(v.filter(e=>e.id===n)),y(!1)},[n,v]),Object(q.jsx)(i.a.Content,{style:{height:"100%",overflow:"auto",padding:"2rem"},children:Object(q.jsxs)(r.a,{style:{height:"100%"},children:[Object(q.jsxs)(l.a,{span:6,style:{boxShadow:"1px 3px 23px 1px rgba(0, 0, 0, 0.095)",borderRadius:"12px !important",background:"white",height:"100%",overflow:"auto"},children:[Object(q.jsx)(c.a,{loading:S,style:{width:"100%",padding:"8px"},placeholder:"Selecciona una ciudad",onSelect:e=>{a(e)},children:v.map((e,t)=>{let{id:n,name:a}=e;return Object(q.jsx)(c.a.Option,{value:n,children:a},t)})}),n>0&&Object(q.jsx)(L,{reference:"report-zones",filterDefaultValues:{city_id:n},center:{lat:o&&parseFloat(o[0].lat),lng:o&&parseFloat(o[0].lng)},selected:u,refresh:h,onSelect:e=>g(e),onSubmit:()=>{O(e=>!e),y(!1)},onItemSelect:e=>{g(e),O(e=>!e),e.polygon&&p(JSON.parse(e.polygon))},restaurant_id:n,cities:o&&o[0]})]}),n>0&&Object(q.jsx)(l.a,{span:18,style:{boxShadow:"1px 3px 23px 1px rgba(0, 0, 0, 0.095)",borderRadius:"12px !important",background:"white"},children:x&&Object(q.jsx)(A,{height:"100%",reference:"report-zones",onMapChange:(e,t)=>{if(0===f.a.differenceBy(e,t.path,"lat","lng").length)return;return Object(z.b)("report-zones").patch(t.id,{polygon:e}).then(e=>{b.b.success("Pol\xedgono Actualizado!")}).catch(e=>{b.b.error(e.message)})},onSelect:e=>g(e),record:u,selected:u,filterDefaultValues:{city_id:n},polygon:{lat:o&&parseFloat(o[0].lat),lng:o&&parseFloat(o[0].lng)},refresh:!1,item_id:u&&u.id})})]})})}},383:function(e,t,n){"use strict";n.d(t,"a",function(){return l});n(219);var a=n(69),i=n(0),r=n(68);const l=()=>{const e=Object(r.b)("cities"),[t,n]=Object(i.useState)([]),[l,c]=Object(i.useState)(!1);return Object(i.useEffect)(()=>{c(!0),e.find({query:{$limit:1e5,$sort:{name:1}}}).then(e=>{let{data:t}=e;n(t),c(!1)}).catch(e=>{a.b.error(e.message),n([]),c(!1)})},[]),[t,l]}}}]);
//# sourceMappingURL=52.f9ea5902.chunk.js.map